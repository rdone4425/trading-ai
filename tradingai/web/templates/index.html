<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading AI - ä¸“ä¸šäº¤æ˜“ç›‘æ§</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #0f0f23;
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            background: linear-gradient(135deg, #1e3a8a 0%, #7c3aed 100%);
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .navbar-brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .navbar-brand h1 {
            font-size: 1.8em;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .navbar-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .time-range-selector {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: white;
            padding: 8px 15px;
            font-size: 0.9em;
            cursor: pointer;
        }
        
        .refresh-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05);
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        .stat-card h3 {
            font-size: 0.85em;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-icon {
            font-size: 1.2em;
        }
        
        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .stat-card .value.positive {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-card .value.negative {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-card .sub-value {
            font-size: 0.9em;
            color: #6b7280;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .trend-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85em;
        }
        
        .trend-up { color: #10b981; }
        .trend-down { color: #ef4444; }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .content-panel {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }
        
        .panel-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-actions {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
            padding: 6px 15px;
            border-radius: 6px;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }
        
        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            height: 400px;
            margin-bottom: 20px;
        }
        
        /* æœç´¢æ¡† */
        .search-box {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px 15px;
            color: #e0e0e0;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.08);
        }
        
        .search-input::placeholder {
            color: #6b7280;
        }
        
        /* é€‰é¡¹å¡ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 10px 25px;
            cursor: pointer;
            border: none;
            background: rgba(255, 255, 255, 0.05);
            font-size: 0.95em;
            color: #9ca3af;
            transition: all 0.3s ease;
            border-radius: 8px;
            white-space: nowrap;
            border: 1px solid transparent;
        }
        
        .tab:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        
        /* åˆ†æåˆ—è¡¨ */
        .analysis-list {
            display: grid;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .analysis-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .analysis-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        .analysis-list::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 3px;
        }
        
        .analysis-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 18px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .analysis-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateX(5px);
        }
        
        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .symbol {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .action-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .action-badge.long {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.5);
        }
        
        .action-badge.short {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.5);
        }
        
        .action-badge.wait {
            background: rgba(156, 163, 175, 0.2);
            color: #9ca3af;
            border: 1px solid rgba(156, 163, 175, 0.5);
        }
        
        .analysis-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 12px;
        }
        
        .metric {
            background: rgba(255, 255, 255, 0.03);
            padding: 10px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .metric-label {
            font-size: 0.75em;
            color: #6b7280;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        
        .metric-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #e0e0e0;
        }
        
        .confidence-bar {
            margin-top: 12px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #10b981 100%);
            transition: width 0.3s ease;
        }
        
        .analysis-reason {
            margin-top: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-left: 3px solid #667eea;
            border-radius: 4px;
            color: #9ca3af;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        /* ä¾§è¾¹æ ç»Ÿè®¡ */
        .sidebar-stats {
            display: grid;
            gap: 15px;
        }
        
        .mini-stat {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .mini-stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .mini-stat-label {
            font-size: 0.85em;
            color: #6b7280;
            text-transform: uppercase;
        }
        
        .mini-stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #e0e0e0;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 60px;
            color: #6b7280;
        }
        
        .loading-spinner {
            border: 3px solid rgba(102, 126, 234, 0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* æ—¶é—´æˆ³ */
        .timestamp {
            text-align: center;
            color: #6b7280;
            margin-top: 30px;
            font-size: 0.9em;
            padding: 15px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card .value {
                font-size: 2em;
            }
            
            .analysis-metrics {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-brand">
            <h1>
                <span class="status-indicator"></span>
                ğŸ“Š Trading AI ç›‘æ§ä¸­å¿ƒ
            </h1>
        </div>
        <div class="navbar-actions">
            <select class="time-range-selector" id="timeRangeSelector" onchange="changeTimeRange()">
                <option value="7">æœ€è¿‘7å¤©</option>
                <option value="30" selected>æœ€è¿‘30å¤©</option>
                <option value="90">æœ€è¿‘90å¤©</option>
                <option value="365">æœ€è¿‘ä¸€å¹´</option>
            </select>
            <button class="refresh-btn" onclick="loadData()">
                <span>ğŸ”„</span>
                <span>åˆ·æ–°æ•°æ®</span>
            </button>
        </div>
    </nav>
    
    <div class="container">
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3><span class="stat-icon">ğŸ“ˆ</span> æ€»äº¤æ˜“æ¬¡æ•°</h3>
                <div class="value" id="totalTrades">-</div>
                <div class="sub-value">
                    <span>ç»Ÿè®¡å‘¨æœŸ: <span id="periodDays">30</span> å¤©</span>
                    <span class="trend-indicator trend-up" id="tradesTrend">â†‘ 12%</span>
                </div>
            </div>
            
            <div class="stat-card">
                <h3><span class="stat-icon">ğŸ¯</span> èƒœç‡</h3>
                <div class="value" id="winRate">-</div>
                <div class="sub-value">
                    <span><span id="winningTrades">-</span> èƒœ / <span id="losingTrades">-</span> è´Ÿ</span>
                    <span class="trend-indicator trend-up" id="winRateTrend">â†‘ 5%</span>
                </div>
            </div>
            
            <div class="stat-card">
                <h3><span class="stat-icon">âš–ï¸</span> ç›ˆäºæ¯”</h3>
                <div class="value" id="profitLossRatio">-</div>
                <div class="sub-value">
                    <span>å¹³å‡ç›ˆåˆ© / å¹³å‡äºæŸ</span>
                    <span class="trend-indicator" id="plRatioTrend">-</span>
                </div>
            </div>
            
            <div class="stat-card">
                <h3><span class="stat-icon">ğŸ’°</span> å‡€åˆ©æ¶¦</h3>
                <div class="value" id="netProfit">-</div>
                <div class="sub-value">
                    <span>ROI: <span id="roi">-</span></span>
                    <span class="trend-indicator" id="profitTrend">-</span>
                </div>
            </div>
            
            <div class="stat-card">
                <h3><span class="stat-icon">ğŸ“Š</span> å¹³å‡ç›ˆåˆ©</h3>
                <div class="value positive" id="avgProfit">-</div>
                <div class="sub-value">
                    <span>å•ç¬”å¹³å‡</span>
                </div>
            </div>
            
            <div class="stat-card">
                <h3><span class="stat-icon">ğŸ“‰</span> å¹³å‡äºæŸ</h3>
                <div class="value negative" id="avgLoss">-</div>
                <div class="sub-value">
                    <span>å•ç¬”å¹³å‡</span>
                </div>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- å·¦ä¾§ï¼šå›¾è¡¨å’Œåˆ†æ -->
            <div>
                <div class="content-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">ğŸ“ˆ æ”¶ç›Šæ›²çº¿</h2>
                    </div>
                    <div id="profitChart" class="chart-container"></div>
                </div>
                
                <div class="content-panel" style="margin-top: 20px;">
                    <div class="panel-header">
                        <h2 class="panel-title">ğŸ“‹ åˆ†æè®°å½•</h2>
                        <div class="panel-actions">
                            <button class="filter-btn active" onclick="filterAnalysis('all')">å…¨éƒ¨</button>
                            <button class="filter-btn" onclick="filterAnalysis('long')">åšå¤š</button>
                            <button class="filter-btn" onclick="filterAnalysis('short')">åšç©º</button>
                            <button class="filter-btn" onclick="filterAnalysis('wait')">è§‚æœ›</button>
                        </div>
                    </div>
                    
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="ğŸ” æœç´¢äº¤æ˜“å¯¹..." id="searchInput" oninput="searchAnalysis()">
                    </div>
                    
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('analysis')">ğŸ“ˆ æœ€æ–°åˆ†æ</button>
                        <button class="tab" onclick="switchTab('trades')">ğŸ’° äº¤æ˜“è®°å½•</button>
                        <button class="tab" onclick="switchTab('learning')">ğŸ“ å­¦ä¹ è®°å½•</button>
                    </div>
                    
                    <div id="analysis-content" class="tab-content">
                        <div id="analysisList" class="analysis-list">
                            <div class="loading">
                                <div class="loading-spinner"></div>
                                <p>åŠ è½½ä¸­...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="trades-content" class="tab-content" style="display: none;">
                        <div id="tradesList" class="analysis-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ“¦</div>
                                <p>æš‚æ— äº¤æ˜“è®°å½•</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="learning-content" class="tab-content" style="display: none;">
                        <div id="learningList" class="analysis-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ“</div>
                                <p>æš‚æ— å­¦ä¹ è®°å½•</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šç»Ÿè®¡é¢æ¿ -->
            <div>
                <div class="content-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">ğŸ“Š å®æ—¶ç»Ÿè®¡</h2>
                    </div>
                    <div id="winRateChart" class="chart-container" style="height: 300px;"></div>
                </div>
                
                <div class="content-panel" style="margin-top: 20px;">
                    <div class="panel-header">
                        <h2 class="panel-title">ğŸ¯ å¿«é€ŸæŒ‡æ ‡</h2>
                    </div>
                    <div class="sidebar-stats">
                        <div class="mini-stat">
                            <div class="mini-stat-header">
                                <span class="mini-stat-label">æœ€å¤§è¿èƒœ</span>
                                <span>ğŸ”¥</span>
                            </div>
                            <div class="mini-stat-value" id="maxWinStreak">-</div>
                        </div>
                        
                        <div class="mini-stat">
                            <div class="mini-stat-header">
                                <span class="mini-stat-label">æœ€å¤§è¿äº</span>
                                <span>â„ï¸</span>
                            </div>
                            <div class="mini-stat-value" id="maxLossStreak">-</div>
                        </div>
                        
                        <div class="mini-stat">
                            <div class="mini-stat-header">
                                <span class="mini-stat-label">æœ€å¤§å•ç¬”ç›ˆåˆ©</span>
                                <span>ğŸ’</span>
                            </div>
                            <div class="mini-stat-value" id="maxProfit">-</div>
                        </div>
                        
                        <div class="mini-stat">
                            <div class="mini-stat-header">
                                <span class="mini-stat-label">æœ€å¤§å•ç¬”äºæŸ</span>
                                <span>âš ï¸</span>
                            </div>
                            <div class="mini-stat-value" id="maxLoss">-</div>
                        </div>
                        
                        <div class="mini-stat">
                            <div class="mini-stat-header">
                                <span class="mini-stat-label">ä»Šæ—¥äº¤æ˜“</span>
                                <span>ğŸ“…</span>
                            </div>
                            <div class="mini-stat-value" id="todayTrades">-</div>
                        </div>
                        
                        <div class="mini-stat">
                            <div class="mini-stat-header">
                                <span class="mini-stat-label">æ´»è·ƒåº¦</span>
                                <span>âš¡</span>
                            </div>
                            <div class="mini-stat-value" id="activityRate">-</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="timestamp" id="timestamp">æœ€åæ›´æ–°: -</div>
    </div>
    
    <script>
        let currentTab = 'analysis';
        let currentFilter = 'all';
        let allAnalysisData = [];
        let profitChart = null;
        let winRateChart = null;
        
        // åˆ‡æ¢é€‰é¡¹å¡
        function switchTab(tab) {
            currentTab = tab;
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(c => c.style.display = 'none');
            document.getElementById(`${tab}-content`).style.display = 'block';
        }
        
        // è¿‡æ»¤åˆ†æ
        function filterAnalysis(filter) {
            currentFilter = filter;
            
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            updateAnalysisDisplay();
        }
        
        // æœç´¢åˆ†æ
        function searchAnalysis() {
            updateAnalysisDisplay();
        }
        
        // æ›´æ–°åˆ†ææ˜¾ç¤º
        function updateAnalysisDisplay() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            let filtered = allAnalysisData;
            
            // åº”ç”¨è¿‡æ»¤å™¨
            if (currentFilter !== 'all') {
                filtered = filtered.filter(item => {
                    const action = (item.action || '').toLowerCase();
                    if (currentFilter === 'long') return action === 'long' || action.includes('åšå¤š');
                    if (currentFilter === 'short') return action === 'short' || action.includes('åšç©º');
                    if (currentFilter === 'wait') return action === 'wait' || action.includes('è§‚æœ›');
                    return true;
                });
            }
            
            // åº”ç”¨æœç´¢
            if (searchTerm) {
                filtered = filtered.filter(item => 
                    (item.symbol || '').toLowerCase().includes(searchTerm)
                );
            }
            
            updateAnalysis(filtered);
        }
        
        // åˆ‡æ¢æ—¶é—´èŒƒå›´
        function changeTimeRange() {
            loadData();
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const days = document.getElementById('timeRangeSelector').value;
                const response = await fetch('/api/dashboard');
                const result = await response.json();
                
                if (result.success) {
                    allAnalysisData = result.data.recent_analysis || [];
                    updateStats(result.data.stats_30d);
                    updateAnalysisDisplay();
                    updateTrades(result.data.all_trades);
                    updateCharts(result.data);
                    updateAdvancedStats(result.data.all_trades);
                    
                    document.getElementById('timestamp').textContent = 
                        `æœ€åæ›´æ–°: ${new Date(result.timestamp).toLocaleString('zh-CN')}`;
                } else {
                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', result.error);
                }
            } catch (error) {
                console.error('è¯·æ±‚å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡å¡ç‰‡
        function updateStats(stats) {
            document.getElementById('totalTrades').textContent = stats.total_trades;
            document.getElementById('periodDays').textContent = stats.period_days;
            document.getElementById('winRate').textContent = `${stats.win_rate}%`;
            document.getElementById('winningTrades').textContent = stats.winning_trades;
            document.getElementById('losingTrades').textContent = stats.losing_trades;
            document.getElementById('profitLossRatio').textContent = stats.profit_loss_ratio.toFixed(2);
            
            const netProfitEl = document.getElementById('netProfit');
            netProfitEl.textContent = `${stats.net_profit >= 0 ? '+' : ''}${stats.net_profit} USDT`;
            netProfitEl.className = `value ${stats.net_profit >= 0 ? 'positive' : 'negative'}`;
            
            document.getElementById('roi').textContent = `${stats.roi >= 0 ? '+' : ''}${stats.roi}%`;
            document.getElementById('avgProfit').textContent = `+${stats.avg_profit} USDT`;
            document.getElementById('avgLoss').textContent = `-${stats.avg_loss} USDT`;
            
            // æ›´æ–°è¶‹åŠ¿æŒ‡æ ‡
            const profitTrend = document.getElementById('profitTrend');
            if (stats.net_profit >= 0) {
                profitTrend.className = 'trend-indicator trend-up';
                profitTrend.textContent = 'â†‘';
            } else {
                profitTrend.className = 'trend-indicator trend-down';
                profitTrend.textContent = 'â†“';
            }
        }
        
        // æ›´æ–°é«˜çº§ç»Ÿè®¡
        function updateAdvancedStats(trades) {
            if (!trades || trades.length === 0) {
                document.getElementById('maxWinStreak').textContent = '0';
                document.getElementById('maxLossStreak').textContent = '0';
                document.getElementById('maxProfit').textContent = '0';
                document.getElementById('maxLoss').textContent = '0';
                document.getElementById('todayTrades').textContent = '0';
                document.getElementById('activityRate').textContent = '0%';
                return;
            }
            
            // è®¡ç®—è¿èƒœè¿äº
            let currentStreak = 0;
            let maxWin = 0, maxLoss = 0;
            
            trades.forEach(trade => {
                if (trade.profit > 0) {
                    currentStreak = currentStreak > 0 ? currentStreak + 1 : 1;
                    maxWin = Math.max(maxWin, currentStreak);
                } else if (trade.profit < 0) {
                    currentStreak = currentStreak < 0 ? currentStreak - 1 : -1;
                    maxLoss = Math.max(maxLoss, Math.abs(currentStreak));
                }
            });
            
            // æœ€å¤§å•ç¬”ç›ˆäº
            const profits = trades.map(t => t.profit || 0);
            const maxProfit = Math.max(...profits);
            const minProfit = Math.min(...profits);
            
            // ä»Šæ—¥äº¤æ˜“
            const today = new Date().toISOString().split('T')[0];
            const todayTrades = trades.filter(t => 
                t.timestamp && t.timestamp.startsWith(today)
            ).length;
            
            // æ´»è·ƒåº¦ï¼ˆæœ€è¿‘7å¤©å¹³å‡æ¯å¤©äº¤æ˜“æ¬¡æ•°ï¼‰
            const recentTrades = trades.slice(-50);
            const activityRate = recentTrades.length > 0 ? 
                (recentTrades.length / 7 * 10).toFixed(0) : 0;
            
            document.getElementById('maxWinStreak').textContent = maxWin;
            document.getElementById('maxLossStreak').textContent = maxLoss;
            document.getElementById('maxProfit').textContent = `+${maxProfit.toFixed(2)}`;
            document.getElementById('maxLoss').textContent = minProfit.toFixed(2);
            document.getElementById('todayTrades').textContent = todayTrades;
            document.getElementById('activityRate').textContent = `${activityRate}%`;
        }
        
        // æ›´æ–°å›¾è¡¨
        function updateCharts(data) {
            // æ”¶ç›Šæ›²çº¿å›¾
            if (!profitChart) {
                profitChart = echarts.init(document.getElementById('profitChart'));
            }
            
            const trades = data.all_trades || [];
            let cumulative = 0;
            const profitData = trades.map((trade, index) => {
                cumulative += trade.profit || 0;
                return {
                    time: trade.timestamp ? new Date(trade.timestamp).toLocaleDateString('zh-CN', {month: '2-digit', day: '2-digit'}) : `äº¤æ˜“${index+1}`,
                    profit: cumulative.toFixed(2)
                };
            });
            
            profitChart.setOption({
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'axis',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: '#667eea',
                    textStyle: { color: '#e0e0e0' }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: profitData.map(d => d.time),
                    axisLine: { lineStyle: { color: '#4b5563' } },
                    axisLabel: { color: '#9ca3af' }
                },
                yAxis: {
                    type: 'value',
                    axisLine: { lineStyle: { color: '#4b5563' } },
                    axisLabel: { color: '#9ca3af' },
                    splitLine: { lineStyle: { color: '#374151', type: 'dashed' } }
                },
                series: [{
                    name: 'ç´¯è®¡æ”¶ç›Š',
                    type: 'line',
                    data: profitData.map(d => d.profit),
                    smooth: true,
                    itemStyle: { color: '#667eea' },
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: 'rgba(102, 126, 234, 0.3)' },
                                { offset: 1, color: 'rgba(102, 126, 234, 0.05)' }
                            ]
                        }
                    }
                }]
            });
            
            // èƒœç‡é¥¼å›¾
            if (!winRateChart) {
                winRateChart = echarts.init(document.getElementById('winRateChart'));
            }
            
            const stats = data.stats_30d;
            winRateChart.setOption({
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'item',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: '#667eea',
                    textStyle: { color: '#e0e0e0' }
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    textStyle: { color: '#9ca3af' }
                },
                series: [{
                    name: 'äº¤æ˜“ç»Ÿè®¡',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    center: ['40%', '50%'],
                    data: [
                        { value: stats.winning_trades, name: 'ç›ˆåˆ©äº¤æ˜“', itemStyle: { color: '#10b981' } },
                        { value: stats.losing_trades, name: 'äºæŸäº¤æ˜“', itemStyle: { color: '#ef4444' } }
                    ],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                    label: {
                        color: '#e0e0e0',
                        formatter: '{b}: {c}æ¬¡\n({d}%)'
                    }
                }]
            });
        }
        
        // æ›´æ–°åˆ†æç»“æœ
        function updateAnalysis(analysis) {
            const listEl = document.getElementById('analysisList');
            
            if (!analysis || analysis.length === 0) {
                listEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“Š</div><p>æš‚æ— åˆ†æç»“æœ</p></div>';
                return;
            }
            
            listEl.innerHTML = analysis.map(item => {
                const actionClass = (item.action || '').toLowerCase().includes('long') || (item.action || '').includes('åšå¤š') ? 'long' :
                                   (item.action || '').toLowerCase().includes('short') || (item.action || '').includes('åšç©º') ? 'short' : 'wait';
                const actionText = actionClass === 'long' ? 'LONG åšå¤š' : 
                                  actionClass === 'short' ? 'SHORT åšç©º' : 'WAIT è§‚æœ›';
                const confidence = item.confidence || 0;
                
                return `
                    <div class="analysis-item">
                        <div class="analysis-header">
                            <span class="symbol">ğŸ’ ${item.symbol || '-'}</span>
                            <span class="action-badge ${actionClass}">${actionText}</span>
                        </div>
                        <div class="analysis-metrics">
                            <div class="metric">
                                <div class="metric-label">å…¥åœºä»·</div>
                                <div class="metric-value">${item.entry_price || '-'}</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">æ­¢æŸ</div>
                                <div class="metric-value">${item.stop_loss || '-'}</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">æ­¢ç›ˆ</div>
                                <div class="metric-value">${item.take_profit || '-'}</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">æ æ†</div>
                                <div class="metric-value">${item.leverage || '-'}x</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">ä¿¡å¿ƒåº¦</div>
                                <div class="metric-value">${confidence}%</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">æ—¶é—´</div>
                                <div class="metric-value">${item.timestamp ? new Date(item.timestamp).toLocaleString('zh-CN', {month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'}) : '-'}</div>
                            </div>
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidence}%"></div>
                        </div>
                        ${item.reason ? `<div class="analysis-reason">${item.reason}</div>` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // æ›´æ–°äº¤æ˜“è®°å½•
        function updateTrades(trades) {
            const listEl = document.getElementById('tradesList');
            
            if (!trades || trades.length === 0) {
                listEl.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“¦</div><p>æš‚æ— äº¤æ˜“è®°å½•</p></div>';
                return;
            }
            
            listEl.innerHTML = trades.map(trade => {
                const isProfit = (trade.profit || 0) >= 0;
                const actionClass = isProfit ? 'long' : 'short';
                
                return `
                    <div class="analysis-item">
                        <div class="analysis-header">
                            <span class="symbol">ğŸ’ ${trade.symbol || '-'}</span>
                            <span class="action-badge ${actionClass}">
                                ${isProfit ? 'ç›ˆåˆ©' : 'äºæŸ'}: ${(trade.profit || 0).toFixed(2)} USDT
                            </span>
                        </div>
                        <div class="analysis-metrics">
                            <div class="metric">
                                <div class="metric-label">å…¥åœº</div>
                                <div class="metric-value">${trade.entry_price || '-'}</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">å‡ºåœº</div>
                                <div class="metric-value">${trade.exit_price || '-'}</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">æ æ†</div>
                                <div class="metric-value">${trade.leverage || '-'}x</div>
                            </div>
                            <div class="metric">
                                <div class="metric-label">æ—¶é—´</div>
                                <div class="metric-value">${trade.timestamp ? new Date(trade.timestamp).toLocaleString('zh-CN', {month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit'}) : '-'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        loadData();
        
        // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°
        setInterval(loadData, 30000);
        
        // å“åº”å¼å›¾è¡¨
        window.addEventListener('resize', () => {
            if (profitChart) profitChart.resize();
            if (winRateChart) winRateChart.resize();
        });
    </script>
</body>
</html>
